--- #!~base
description: Repoguard rules to test for generic best practices
extends: whitelisted_files::whitelisted_files,comments::comments

--- #!unsecure_protocol
extends: base
diff: add
line:
    - match: (http|ftp)://.*
    - except: "http://localhost"
    - except: xmlns|doctype|DOCTYPE|<prezi><documentStyle>|template|createElementNS
file:
    - except: '\.(po|json|html|xml|xaml|ism|markdown|md|txt|csv|doc|rdoc|css|gradle|properties|log|wiki)$'
    - except: 'scripts/(build|common|release|bootstrap)'
    - except: '^/cookbooks/.*\.rb$'
    - except: 'templates/'
tests:
    - pass: " http://example.com"
    - fail: "http://localhost"
    - fail: '<databases xmlns:db="http://agavi.org/agavi/config/parts/databases/1.0" xmlns:ae="http://agavi.org/agavi/config/global/envelope/1.0">'

--- #!dangerous_redirect
extends: base
diff: add
line:
    - match: (HttpResponseRedirect|HttpResponsePermanentRedirect|redirect)(?!\(["'][^"']+["']\))
    - except: <bindingRedirect
file:
    - except: '(\.config|\.po|\.po\.json|\.md|\.rb)$'
tests:
    - pass: " HttpResponseRedirect($_GET['to'])"
    - fail: "HttpResponseRedirect('OK')"
    - fail: 'HttpResponseRedirect("OK")'
    - fail: '<bindingRedirect foobar'
